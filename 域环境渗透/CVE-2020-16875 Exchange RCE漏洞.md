**目录**​​​​​​​

[漏洞背景](#t0 "漏洞背景")

[漏洞影响版本](#t1 "漏洞影响版本")

[漏洞复现](#t2 "漏洞复现")

[漏洞利用](#t3 "漏洞利用")

[漏洞修复](#t4 "漏洞修复")

* * *

漏洞背景
----

2020年09月08日微软发布漏洞通告：[CVE-2020-16875 | Microsoft Exchange Server 远程执行代码漏洞](https://msrc.microsoft.com/update-guide/zh-cn/vulnerability/CVE-2020-16875 "CVE-2020-16875 | Microsoft Exchange Server 远程执行代码漏洞")

由于对cmdlet参数的验证不正确，Microsoft Exchange服务器中存在一个远程执行代码漏洞。成功利用此漏洞的攻击者可以在系统用户的上下文中运行任意代码。利用该漏洞，攻击者可从特定 Exchange 用户提升到操作系统 SYSTEM 权限，攻击者首先需获得特定权限的邮箱用户(拥有Data Loss Prevention角色权限的用户)，该用户需能够访问 /ecp/DLPPolicy/ManagePolicyFromISV.aspx 方可利用此漏洞。

漏洞影响版本
------

*   microsoft  exchange\_server\_2016: cu16/cu17
*   microsoft  exchange\_server\_2019: cu5/cu6

漏洞复现
----

首先搭建Exchange2016的环境，新建邮箱用户，无权限的用户访问/ecp/DLPPolicy/ManagePolicyFromISV.aspx 路径显示403拒绝访问

![](https://img-blog.csdnimg.cn/img_convert/86d1073aac094326732d6be0782e00f5.png)

在Exchange服务器上打开Exchange Management Shell，输入如下命令：

```
#新建一个角色组dlp\_uses，其角色是Data Loss Prevention，并将test用户加入该组
New-RoleGroup -Name "dlp\_users" -Roles "Data Loss Prevention" -Members "test"

#查询dlp\_users组的用户
Get-RoleGroup "dlp\_users" | Format-List
```


![](https://img-blog.csdnimg.cn/img_convert/5b439d82f8ce5692333c8b456d849e10.png)

然后再使用test用户访问/ecp/DLPPolicy/ManagePolicyFromISV.aspx 路径，则可以正常访问了 。可以看到页面显示的是导入DLP策略

![](https://img-blog.csdnimg.cn/img_convert/92aea14ba0126dc75f8ec1739cad351b.png)

那么，什么是DLP？

```
防止数据丢失(Data loss Prevention)是Exchange Server 2013带来的一个新功能，感觉其实应该叫做防止数据泄露，许多第三方工具和设备也有类似的功能，而在Exchange 2013中直接集成了，并且之前的传输规则也整合到了一起。该功能通过对内容的深入分析，能够帮助企业识别、监控和保护敏感信息传递。
DLP通过关键字匹配、词典匹配、正则表达式的评估，和其他内容的检查，深入分析内容以发现组织内违法DLP规则的内容。一旦发现了违反了规则的内容，DLP会对用户进行提醒或者是组织，告知提醒用户邮件包含敏感内容或者违规传递。
```


### 漏洞利用

```
python3 cve-2020-16875.py 10.211.55.5 test@xie.com:P@ss1234 whoami
```


该脚本执行没有回显，可用于检测是否存在漏洞

![](https://img-blog.csdnimg.cn/img_convert/1d9af1b6b889ad6591ad7b13f7093f7b.png)

漏洞修复
----

通过如下链接自行寻找符合操作系统版本的漏洞补丁，并进行补丁下载安装：

[Security Update Guide - Microsoft Security Response Center](https://msrc.microsoft.com/update-guide/zh-cn/vulnerability/CVE-2020-16875 "Security Update Guide - Microsoft Security Response Center")

  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)

参考文章：[Exchange漏洞分析系列 CVE-2020-16875 - 安全客，安全资讯平台](https://www.anquanke.com/post/id/219091 "Exchange漏洞分析系列 CVE-2020-16875 - 安全客，安全资讯平台")