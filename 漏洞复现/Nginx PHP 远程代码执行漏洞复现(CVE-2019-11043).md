**目录**

[CVE-2019-11043](#t0 "CVE-2019-11043")

[漏洞描述](#t1 "漏洞描述")

[漏洞影响版本](#t2 "漏洞影响版本 ") 

[漏洞复现](#t3 "漏洞复现")

[漏洞修复](#t4 "漏洞修复")

* * *

CVE-2019-11043
--------------

### **漏洞描述**

    来自Wallarm的安全研究员Andrew Danau在9月14-16号举办的Real World CTF中，意外的向服务器发送%0a(换行符)时，服务器返回异常信息。由此发现了这个0day漏洞

   当[Nginx](https://so.csdn.net/so/search?q=Nginx&spm=1001.2101.3001.7020)使用特定的 fastcgi 配置时，存在远程代码执行漏洞，但这个配置并非是Nginx的默认配置。只有当fastcgi\_split\_path\_info 字段被配置为 ^(.+?\\.php)(/.\*)$; 时，攻击者可以通过精心构造的payload，造成远程代码执行漏洞。由于该配置已被广泛使用，所以危害较大

### **漏洞影响版本** 

当 Nginx + php-fpm 的服务器有如下配置的时候，都会出现远程代码执行漏洞

```
location ~ [^/]\.php(/|$) {      
  ...      
  fastcgi_split_path_info ^(.+?\.php)(/.*)$;      
  fastcgi_param PATH_INFO       $fastcgi_path_info;      
  fastcgi_pass   php:9000;      
  ...      
}
```


### **漏洞复现**

启动靶机环境(Vulhub)

![](https://img-blog.csdnimg.cn/20191024165001856.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

下载漏洞利用poc：[https://github.com/neex/phuip-fpizdam](https://github.com/neex/phuip-fpizdam "https://github.com/neex/phuip-fpizdam") ，重命名为 CVE-2019-11043

到该目录下，执行以下命令(需要有go语言的环境)

```
go run . "http://192.168.10.13:8080/index.php"
```


![](https://img-blog.csdnimg.cn/20191024170740262.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

访问网站，[http://192.168.10.13:8080/index.php?a=](http://192.168.10.13:8080/index.php?a=cat%20/etc/passwd "http://192.168.10.13:8080/index.php?a=")命令

![](https://img-blog.csdnimg.cn/20191024170145195.png)

![](https://img-blog.csdnimg.cn/20191024170556319.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

注：由于  php-fpm 会启动多个子进程，所以在访问 `/index.php?a=` 时需要多访问几次，以访问到被污染的进程。

### **漏洞修复**

删除 Nginx 配置文件中的如下配置：

```
fastcgi_split_path_info ^(.+?\.php)(/.*)$;      
fastcgi_paramPATH_INFO       $fastcgi_path_info;
```


  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)

参考文章： [https://github.com/neex/phuip-fpizdam](https://github.com/neex/phuip-fpizdam "https://github.com/neex/phuip-fpizdam")

                  [Nginx+PHP 远程代码执行漏洞 （CVE-2019-11043）预警](https://mp.weixin.qq.com/s/Oz323_0GCC0bxwZK7xYD3g "Nginx+PHP 远程代码执行漏洞 （CVE-2019-11043）预警")

                  [CVE-2019-11043-PHP远程代码执行漏洞](https://mrxn.net/news/640.html "CVE-2019-11043-PHP远程代码执行漏洞")