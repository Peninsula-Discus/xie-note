**目录**

[CVE-2014-3120](#t0 "CVE-2014-3120")

[CVE-2015-1427](#t1 "CVE-2015-1427")

* * *

### CVE-2014-3120

老版本[ElasticSearch](https://so.csdn.net/so/search?q=ElasticSearch&spm=1001.2101.3001.7020)支持传入动态脚本（MVEL）来执行一些复杂的操作，而MVEL可执行Java代码，而且没有沙盒，所以我们可以直接执行任意代码。

**复现环境：**[http://192.168.10.13:9200/](http://192.168.10.13:9200/ "http://192.168.10.13:9200/")

![](https://img-blog.csdnimg.cn/20191107111632761.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

**漏洞利用：MSF**

search  CVE-2014-3120，然后进入对应模块，设置好参数即可攻击

![](https://img-blog.csdnimg.cn/20191107111724383.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

注：由于查询时至少要求es中有一条数据，所以如果是新搭建好的靶机环境的话，需要增加一个数据。

### CVE-2015-1427

CVE-2014-3120后，ElasticSearch默认的动态脚本语言换成了Groovy，并增加了沙盒，但默认仍然支持直接执行动态语言。本漏洞：1.是一个沙盒绕过； 2.是一个Goovy代码执行漏洞。

**Groovy语言“沙盒”**

ElasticSearch支持使用“在沙盒中的”Groovy语言作为动态脚本，但显然官方的工作并没有做好。lupin和tang3分别提出了两种执行命令的方法：

1.  既然对执行Java代码有沙盒，lupin的方法是想办法绕过沙盒，比如使用Java反射
2.  Groovy原本也是一门语言，于是tang3另辟蹊径，使用Groovy语言支持的方法，来直接执行命令，无需使用Java语言

所以，根据这两种执行漏洞的思路，我们可以获得两个不同的POC。

**复现环境：**

![](https://img-blog.csdnimg.cn/20191107112033449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

**漏洞利用：MSF**

search CVE-2015-1427，然后进入对应模块，设置好参数即可攻击![](https://img-blog.csdnimg.cn/20191107112919162.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

注：由于查询时至少要求es中有一条数据，所以如果是新搭建好的靶机环境的话，需要增加一个数据。

  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)

参考文章：[ElasticSearch 命令执行漏洞（CVE-2014-3120）](https://vulhub.org/#/environments/elasticsearch/CVE-2014-3120/ "ElasticSearch 命令执行漏洞（CVE-2014-3120）")

                  [ElasticSearch Groovy 沙盒绕过 && 代码执行漏洞（CVE-2015-1427）](https://vulhub.org/#/environments/elasticsearch/CVE-2015-1427/ "ElasticSearch Groovy 沙盒绕过 && 代码执行漏洞（CVE-2015-1427）")