**目录**

[背景](#t0 "背景")

[漏洞编号](#t1 "漏洞编号")

[漏洞等级](#t2 "漏洞等级")

[漏洞影响版本](#t3 "漏洞影响版本")

[漏洞复现](#t4 "漏洞复现")

[漏洞修复建议](#t5 "漏洞修复建议")

* * *

### 背景

2020年02月20日， 国家[信息安全](https://so.csdn.net/so/search?q=%E4%BF%A1%E6%81%AF%E5%AE%89%E5%85%A8&spm=1001.2101.3001.7020)漏洞共享平台(CNVD) 收录了 `CNVD-2020-10487` [Apache](https://so.csdn.net/so/search?q=Apache&spm=1001.2101.3001.7020) Tomcat文件包含漏洞

Tomcat是由Apache软件基金会属下Jakarta项目开发的[Servlet](https://so.csdn.net/so/search?q=Servlet&spm=1001.2101.3001.7020)容器，按照Sun Microsystems提供的技术规范，实现了对Servlet和JavaServer Page（JSP）的支持。由于Tomcat本身也内含了HTTP服务器，因此也可以视作单独的Web服务器。

Apache Tomcat会开启AJP连接器,方便与其他Web服务器通过AJP协议进行交互。由于Tomcat本身也内含了HTTP服务器，因此也可以视作单独的Web服务器。此漏洞为文件包含漏洞，攻击者可利用该漏洞读取或包含 Tomcat 上所有 webapp 目录下的任意文件，如：webapp 配置文件、源代码等。

### 漏洞编号

*   CVE-2020-1938 
*   CNVD-2020-10487

### 漏洞等级

高危

### 漏洞影响版本

*   Apache Tomcat = 6
*   7 <= Apache Tomcat < 7.0.100
*   8 <= Apache Tomcat < 8.5.51
*   9 <= Apache Tomcat < 9.0.31

### 漏洞复现

由于太菜，这里直接用POC复现。关注微信公共号：xie\_sec ，回复 CVE-2020-1938 即可得到 POC 链接地址。如果想看漏洞复现详情：  [【WEB安全】Tomcat-Ajp协议漏洞分析](https://mp.weixin.qq.com/s?__biz=MzUyMDEyNTkwNA==&mid=2247483718&idx=1&sn=bbca664d42c3427db69636b30a5e6cca&chksm=f9ee6df9ce99e4efbd82711c9d6926316fe27df8017230a1dd70ddfe1589c84661e9ff6a8f9b&mpshare=1&scene=1&srcid=0220q4JbZQhmsBltaolOaSjH&sharer_sharetime=1582198630690&sharer_shareid=44ef081ceda2f95dd38f50cee7d97b69&key=34378bd54cb2fe7edf9d179c48f7e8fece346e9c9ef1f3f8ba6cdea3edc3d40d1536b5a9aa85bf13643000665098b8c1720d6fc5ea7aab9ceeb96fa409e7cbccc8ccb5917875410e0767e888d59a815c&ascene=1&uin=OTcyNDI0ODMw&devicetype=Windows-QQBrowser&version=6103000b&lang=zh_CN&exportkey=A60hTbCJUMPt9IKr%2FVU7pxE%3D&pass_ticket=B7ny%2FkE%2FRvMb9FddOjYWKKg66mwr0SIXu0pWU1Q%2FwGQM4586tsvpCSV5qFPdbCB0 "【WEB安全】Tomcat-Ajp协议漏洞分析")

这个poc默认目前只能读取webapps/ROOT/ 目录下的文件

![](https://img-blog.csdnimg.cn/20200221121330213.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

读取web.xml配置文件

![](https://img-blog.csdnimg.cn/20200221121155505.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

读取网站index.jsp的源代码

![](https://img-blog.csdnimg.cn/20200221121234514.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### 漏洞修复建议

1：临时禁用AJP协议端口，在conf/server.xml配置文件中注释掉

```
<Connector port="8009" protocol="AJP/1.3"redirectPort="8443" />
```


2：配置ajp配置中的secretRequired跟secret属性来限制认证

3：官方下载最新版下载地址：

     https://tomcat.apache.org/download-70.cgi

    https://tomcat.apache.org/download-80.cgi

    https://tomcat.apache.org/download-90.cgi

   或Github下载：https://github.com/apache/tomcat/releases

  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)

参考文章：[CNVD-2020-10487: Apache Tomcat文件包含漏洞通告](https://cert.360.cn/warning/detail?id=849be16c6d2dd909ff56eee7e26aeefe "CNVD-2020-10487: Apache Tomcat文件包含漏洞通告")

                [【WEB安全】Tomcat-Ajp协议漏洞分析](https://mp.weixin.qq.com/s?__biz=MzUyMDEyNTkwNA==&mid=2247483718&idx=1&sn=bbca664d42c3427db69636b30a5e6cca&chksm=f9ee6df9ce99e4efbd82711c9d6926316fe27df8017230a1dd70ddfe1589c84661e9ff6a8f9b&mpshare=1&scene=1&srcid=0220q4JbZQhmsBltaolOaSjH&sharer_sharetime=1582198630690&sharer_shareid=44ef081ceda2f95dd38f50cee7d97b69&key=34378bd54cb2fe7edf9d179c48f7e8fece346e9c9ef1f3f8ba6cdea3edc3d40d1536b5a9aa85bf13643000665098b8c1720d6fc5ea7aab9ceeb96fa409e7cbccc8ccb5917875410e0767e888d59a815c&ascene=1&uin=OTcyNDI0ODMw&devicetype=Windows-QQBrowser&version=6103000b&lang=zh_CN&exportkey=A60hTbCJUMPt9IKr%2FVU7pxE%3D&pass_ticket=B7ny%2FkE%2FRvMb9FddOjYWKKg66mwr0SIXu0pWU1Q%2FwGQM4586tsvpCSV5qFPdbCB0 "【WEB安全】Tomcat-Ajp协议漏洞分析")